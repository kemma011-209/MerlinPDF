{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ABK/Desktop/Projects/DurHack/MerlinPDF/frontend/components/PdfViewer.tsx"],"sourcesContent":["\"use client\"\r\nimport React from 'react'\r\nimport { Viewer, Worker } from '@react-pdf-viewer/core'\r\nimport type { PageLayout } from '@react-pdf-viewer/core'\r\nimport '@react-pdf-viewer/core/lib/styles/index.css'\r\n\r\ntype PdfViewerProps = {\r\n  onAddNote?: (text: string) => void\r\n  onFileSelected?: (file: File) => void\r\n  file?: File | null\r\n}\r\n\r\nconst PdfViewer = ({ onAddNote, onFileSelected, file }: PdfViewerProps) => {\r\n  const pageLayout: PageLayout = {\r\n    buildPageStyles: () => ({\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      borderRadius: '12px',\r\n      overflow: 'hidden',\r\n      background: '#fafafa',\r\n    }),\r\n  }\r\n\r\n  const containerRef = React.useRef<HTMLDivElement | null>(null)\r\n  const objectUrlRef = React.useRef<string | null>(null)\r\n  const [pdfUrl, setPdfUrl] = React.useState<string>(\"/example.pdf\")\r\n  const [isDragging, setIsDragging] = React.useState(false)\r\n  const [tooltip, setTooltip] = React.useState<{\r\n    x: number\r\n    y: number\r\n    text: string\r\n    visible: boolean\r\n  }>({ x: 0, y: 0, text: '', visible: false })\r\n\r\n  const clearSelectionAndHide = React.useCallback(() => {\r\n    const sel = window.getSelection?.()\r\n    if (sel && sel.removeAllRanges) sel.removeAllRanges()\r\n    setTooltip((t) => ({ ...t, visible: false, text: '' }))\r\n  }, [])\r\n\r\n  React.useEffect(() => {\r\n    const container = containerRef.current\r\n    if (!container) return\r\n\r\n    const handleMouseUp = () => {\r\n      const selection = window.getSelection?.()\r\n      const text = selection?.toString()?.trim() || ''\r\n      if (!text) {\r\n        setTooltip((t) => ({ ...t, visible: false, text: '' }))\r\n        return\r\n      }\r\n      if (!selection || selection.rangeCount === 0) return\r\n      const range = selection.getRangeAt(0)\r\n      const rect = range.getBoundingClientRect()\r\n      const containerRect = container.getBoundingClientRect()\r\n      const x = rect.left - containerRect.left\r\n      const y = rect.top - containerRect.top - 32\r\n      setTooltip({ x, y: y < 0 ? 0 : y, text, visible: true })\r\n    }\r\n\r\n    const handleScroll = () => setTooltip((t) => ({ ...t, visible: false }))\r\n    const handleKey = (e: KeyboardEvent) => { if (e.key === 'Escape') clearSelectionAndHide() }\r\n\r\n    container.addEventListener('mouseup', handleMouseUp)\r\n    container.addEventListener('scroll', handleScroll, true)\r\n    window.addEventListener('keydown', handleKey)\r\n    return () => {\r\n      container.removeEventListener('mouseup', handleMouseUp)\r\n      container.removeEventListener('scroll', handleScroll, true)\r\n      window.removeEventListener('keydown', handleKey)\r\n    }\r\n  }, [clearSelectionAndHide])\r\n\r\n  const handleAdd = () => {\r\n    if (!tooltip.text) return\r\n    onAddNote?.(tooltip.text)\r\n    clearSelectionAndHide()\r\n  }\r\n\r\n  const setNewPdfFromFile = (file: File) => {\r\n    if (!file || file.type !== 'application/pdf') return\r\n    const url = URL.createObjectURL(file)\r\n    if (objectUrlRef.current) URL.revokeObjectURL(objectUrlRef.current)\r\n    objectUrlRef.current = url\r\n    setPdfUrl(url)\r\n    onFileSelected?.(file)\r\n  }\r\n\r\n  const onFileInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const f = e.target.files?.[0]\r\n    if (f) setNewPdfFromFile(f)\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (objectUrlRef.current) URL.revokeObjectURL(objectUrlRef.current)\r\n    }\r\n  }, [])\r\n\r\n  React.useEffect(() => {\r\n    if (file) setNewPdfFromFile(file)\r\n  }, [file])\r\n\r\n  return (\r\n    <div className='w-full flex justify-center'>\r\n      <div\r\n        ref={containerRef}\r\n        className='relative w-full max-w-[900px] h-auto viewer-no-scroll p-2 sm:p-3'\r\n        onDragOver={(e) => { e.preventDefault(); setIsDragging(true) }}\r\n        onDragEnter={(e) => { e.preventDefault(); setIsDragging(true) }}\r\n        onDragLeave={(e) => { e.preventDefault(); setIsDragging(false) }}\r\n        onDrop={(e) => {\r\n          e.preventDefault();\r\n          setIsDragging(false)\r\n          const file = e.dataTransfer?.files?.[0]\r\n          if (file) setNewPdfFromFile(file)\r\n        }}\r\n      >\r\n        <Worker workerUrl=\"https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js\">\r\n          <Viewer\r\n            fileUrl={pdfUrl}\r\n            pageLayout={pageLayout}\r\n            theme={{\r\n              theme: 'light',\r\n              cssVariables: {\r\n                '--rpv-core__viewer-background-color': '#fafafa',\r\n              },\r\n            }}\r\n          />\r\n        </Worker>\r\n\r\n        {/* Drag overlay */}\r\n        {isDragging && (\r\n          <div className=\"absolute inset-0 z-30 flex items-center justify-center bg-black/30\">\r\n            <div className=\"pointer-events-none w-full h-full border-2 border-dashed border-white/80 rounded-xl\"></div>\r\n            <div className=\"absolute px-3 py-1 rounded-md bg-white text-neutral-800 text-xs shadow\">Drop PDF to view</div>\r\n          </div>\r\n        )}\r\n\r\n        {tooltip.visible && (\r\n          <div\r\n            style={{ left: tooltip.x, top: tooltip.y }}\r\n            className=\"absolute z-50 px-2 py-1 rounded-md border shadow-sm bg-white text-neutral-800 text-xs flex items-center gap-2\"\r\n          >\r\n            <span className=\"max-w-[320px] truncate\">{tooltip.text}</span>\r\n            <button\r\n              onClick={handleAdd}\r\n              className=\"h-6 px-2 rounded border text-xs hover:bg-neutral-100\"\r\n            >\r\n              Add note\r\n            </button>\r\n            <button\r\n              onClick={clearSelectionAndHide}\r\n              className=\"h-6 px-2 rounded border text-xs hover:bg-neutral-100\"\r\n            >\r\n              Ã—\r\n            </button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default PdfViewer\r\n\r\n\r\n"],"names":[],"mappings":"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","debugId":null}}]
}