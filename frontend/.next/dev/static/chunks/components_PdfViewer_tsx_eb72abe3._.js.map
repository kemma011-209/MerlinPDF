{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///app/components/PdfViewer.tsx"],"sourcesContent":["\"use client\"\nimport React from 'react'\nimport { Viewer, Worker } from '@react-pdf-viewer/core'\nimport type { PageLayout } from '@react-pdf-viewer/core'\nimport '@react-pdf-viewer/core/lib/styles/index.css'\n\ntype PdfViewerProps = {\n  onAddNote?: (text: string) => void\n  onFileSelected?: (file: File) => void\n  file?: File | null\n}\n\nconst PdfViewer = ({ onAddNote, onFileSelected, file }: PdfViewerProps) => {\n  const pageLayout: PageLayout = {\n    buildPageStyles: () => ({\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      borderRadius: '12px',\n      overflow: 'hidden',\n      background: '#fafafa',\n    }),\n  }\n\n  const containerRef = React.useRef<HTMLDivElement | null>(null)\n  const objectUrlRef = React.useRef<string | null>(null)\n  const [pdfUrl, setPdfUrl] = React.useState<string>(\"/example.pdf\")\n  const [isDragging, setIsDragging] = React.useState(false)\n  const [tooltip, setTooltip] = React.useState<{\n    x: number\n    y: number\n    text: string\n    visible: boolean\n  }>({ x: 0, y: 0, text: '', visible: false })\n\n  const clearSelectionAndHide = React.useCallback(() => {\n    const sel = window.getSelection?.()\n    if (sel && sel.removeAllRanges) sel.removeAllRanges()\n    setTooltip((t) => ({ ...t, visible: false, text: '' }))\n  }, [])\n\n  React.useEffect(() => {\n    const container = containerRef.current\n    if (!container) return\n\n    const handleMouseUp = () => {\n      const selection = window.getSelection?.()\n      const text = selection?.toString()?.trim() || ''\n      if (!text) {\n        setTooltip((t) => ({ ...t, visible: false, text: '' }))\n        return\n      }\n      if (!selection || selection.rangeCount === 0) return\n      const range = selection.getRangeAt(0)\n      const rect = range.getBoundingClientRect()\n      const containerRect = container.getBoundingClientRect()\n      const x = rect.left - containerRect.left\n      const y = rect.top - containerRect.top - 32\n      setTooltip({ x, y: y < 0 ? 0 : y, text, visible: true })\n    }\n\n    const handleScroll = () => setTooltip((t) => ({ ...t, visible: false }))\n    const handleKey = (e: KeyboardEvent) => { if (e.key === 'Escape') clearSelectionAndHide() }\n\n    container.addEventListener('mouseup', handleMouseUp)\n    container.addEventListener('scroll', handleScroll, true)\n    window.addEventListener('keydown', handleKey)\n    return () => {\n      container.removeEventListener('mouseup', handleMouseUp)\n      container.removeEventListener('scroll', handleScroll, true)\n      window.removeEventListener('keydown', handleKey)\n    }\n  }, [clearSelectionAndHide])\n\n  const handleAdd = () => {\n    if (!tooltip.text) return\n    onAddNote?.(tooltip.text)\n    clearSelectionAndHide()\n  }\n\n  const setNewPdfFromFile = (file: File) => {\n    if (!file || file.type !== 'application/pdf') return\n    const url = URL.createObjectURL(file)\n    if (objectUrlRef.current) URL.revokeObjectURL(objectUrlRef.current)\n    objectUrlRef.current = url\n    setPdfUrl(url)\n    onFileSelected?.(file)\n  }\n\n  const onFileInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const f = e.target.files?.[0]\n    if (f) setNewPdfFromFile(f)\n  }\n\n  React.useEffect(() => {\n    return () => {\n      if (objectUrlRef.current) URL.revokeObjectURL(objectUrlRef.current)\n    }\n  }, [])\n\n  React.useEffect(() => {\n    if (file) setNewPdfFromFile(file)\n  }, [file])\n\n  return (\n    <div className='w-full flex justify-center'>\n      <div\n        ref={containerRef}\n        className='relative w-full max-w-[900px] h-auto viewer-no-scroll p-2 sm:p-3'\n        onDragOver={(e) => { e.preventDefault(); setIsDragging(true) }}\n        onDragEnter={(e) => { e.preventDefault(); setIsDragging(true) }}\n        onDragLeave={(e) => { e.preventDefault(); setIsDragging(false) }}\n        onDrop={(e) => {\n          e.preventDefault();\n          setIsDragging(false)\n          const file = e.dataTransfer?.files?.[0]\n          if (file) setNewPdfFromFile(file)\n        }}\n      >\n        <Worker workerUrl=\"https://unpkg.com/pdfjs-dist@3.11.174/build/pdf.worker.min.js\">\n          <Viewer\n            fileUrl={pdfUrl}\n            pageLayout={pageLayout}\n            theme={{\n              theme: 'light',\n              cssVariables: {\n                '--rpv-core__viewer-background-color': '#fafafa',\n              },\n            }}\n          />\n        </Worker>\n\n        {/* Drag overlay */}\n        {isDragging && (\n          <div className=\"absolute inset-0 z-30 flex items-center justify-center bg-black/30\">\n            <div className=\"pointer-events-none w-full h-full border-2 border-dashed border-white/80 rounded-xl\"></div>\n            <div className=\"absolute px-3 py-1 rounded-md bg-white text-neutral-800 text-xs shadow\">Drop PDF to view</div>\n          </div>\n        )}\n\n        {tooltip.visible && (\n          <div\n            style={{ left: tooltip.x, top: tooltip.y }}\n            className=\"absolute z-50 px-2 py-1 rounded-md border shadow-sm bg-white text-neutral-800 text-xs flex items-center gap-2\"\n          >\n            <span className=\"max-w-[320px] truncate\">{tooltip.text}</span>\n            <button\n              onClick={handleAdd}\n              className=\"h-6 px-2 rounded border text-xs hover:bg-neutral-100\"\n            >\n              Add note\n            </button>\n            <button\n              onClick={clearSelectionAndHide}\n              className=\"h-6 px-2 rounded border text-xs hover:bg-neutral-100\"\n            >\n              Ã—\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default PdfViewer\n\n\n"],"names":[],"mappings":"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","debugId":null}}]
}